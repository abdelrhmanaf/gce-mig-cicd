 # Create the new instance template
steps:
- name: 'gcr.io/cloud-builders/gcloud'
  id: create-instance-template
  entrypoint: 'bash'
  args: ['-c','sleep 40 && gcloud compute instance-templates create-with-container cloud-build-instance-template-v1-$_ENV-$SHORT_SHA --custom-cpu=1 --custom-memory=2GB --boot-disk-size=20GB --region=us-central1 --subnet=new-default --tags=allow-hc-and-proxy,allow-ssh --container-image=us.gcr.io/moonlit-sphinx-394612/html-repo/nginx-image:latest']
    
 # Update the managed instance group


- name: 'gcr.io/cloud-builders/gcloud'
  entrypoint: 'bash'
  args: ['-c','gcloud compute instance-groups managed create cloudbuild-mig --template cloud-build-instance-template-v1-$_ENV-$SHORT_SHA  --size 1 --region us-central1']  
  
options:
 logging: CLOUD_LOGGING_ONLY